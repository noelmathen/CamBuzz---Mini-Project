<!-- studprofile.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>User Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        crossorigin="anonymous">
    <link
        href="https://fonts.googleapis.com/css2?family=Pacifico&family=Montserrat:wght@400&family=Raleway:wght@400&display=swap"
        rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="./styles.css">
</head>

<body>
    <div id="navbar-placeholder"></div>
    <section>
        <div class="container py-5">
            <div class="row">
                <div class="col">
                    <nav aria-label="breadcrumb" class="bg-light rounded-3 p-3 mb-4 text-center">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item"><a href="#" class="home-button">HOME</a></li>
                            <li class="breadcrumb-item">
                                <a href="#" class="edit-profile-button" id="changePasswordLink">EDIT PROFILE</a>
                            </li>
                            <li class="breadcrumb-item"><a href="#" class="change-password-button">CHANGE PASSWORD</a>
                            </li>
                            <li class="breadcrumb-item"><a href="#" class="logout-button">LOGOUT</a></li>
                        </ol>
                    </nav>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-4">
                    <div class="card mb-4">
                        <div class="card-body text-center">
                            <img id="photo" src="" alt="avatar" class="rounded-circle img-fluid" style="width: 190px; height: 190px; object-fit: cover; border-radius: 50%;">
                            <h5 id="full_name" class="my-3"></h5>
                            <p id="username" class="text-muted mb-1"></p>
                            <p id="email" class="text-muted mb-4"></p>
                        </div>
                    </div>
                    <div class="card mb-4 mb-lg-0">
                    </div>
                </div>

                <div class="col-lg-8">
                    <div class="card mb-4">
                        <div class="card-body text-left mb-4 justify-content-center">
                            <div class="row justify-content-center">
                                <div class="col-sm-3">
                                    <p class="mb-0">Brach</p>
                                </div>
                                <div class="col-sm-9">
                                    <p id="branch" class="text-muted mb-0"></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row justify-content-center">
                                <div class="col-sm-3">
                                    <p class="mb-0">Division</p>
                                </div>
                                <div class="col-sm-9">
                                    <p id="division" class="text-muted mb-0"></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <p class="mb-0">Batch</p>
                                </div>
                                <div class="col-sm-9">
                                    <p id="batch" class="text-muted mb-0"></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <p class="mb-0">Phone Number</p>
                                </div>
                                <div class="col-sm-9">
                                    <p id="phone_number" class="text-muted mb-0"></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <p class="mb-0">Gender</p>
                                </div>
                                <div class="col-sm-9">
                                    <p id="gender" class="text-muted mb-0"></p>
                                </div>
                            </div>
                            <hr>
                        </div>
                    </div>

                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <a href="/Frontend/Vehicle%20Pooling/my_rides.html"
                                class="card mb-4 mb-md-0 btn btn-primary btn-block custom-button">
                                <div class="card-body text-center">
                                    <p class="mb-4"><span class="text-white font-italic me-1">My Rides</span></p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-6">
                            <a href="/Frontend/Vehicle%20Pooling/my_bookings.html"
                                class="card mb-4 mb-md-0 btn btn-primary btn-block custom-button">
                                <div class="card-body text-center">
                                    <p class="mb-4"><span class="text-white font-italic me-1">My Bookings</span></p>
                                </div>
                            </a>
                        </div>
                    </div>

                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <a href="/Frontend/FoodSpotRecommendations/my_recommendations.html"
                                class="card mb-4 mb-md-0 btn btn-primary btn-block custom-button">
                                <div class="card-body text-center">
                                    <p class="mb-4"><span class="text-white font-italic me-1">My Reviews</span></p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <!-- Form for changing password -->
                    <form id="changePasswordForm">
                        <!-- Current Password -->
                        <div class="form-group">
                            <label for="currentPassword">Current Password:</label>
                            <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                        </div>

                        <!-- New Password -->
                        <div class="form-group">
                            <label for="newPassword">New Password:</label>
                            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                        </div>

                        <!-- Confirm New Password -->
                        <div class="form-group">
                            <label for="confirmNewPassword">Confirm New Password:</label>
                            <input type="password" class="form-control" id="confirmNewPassword"
                                name="confirmNewPassword" required>
                        </div>

                        <!-- Error Messages -->
                        <div class="alert alert-danger" id="errorMessages" style="display: none;"></div>

                        <!-- Submit Button -->
                        <button type="button" class="btn btn-primary" onclick="changePassword()">Change Password</button>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <!-- Include Bootstrap and jQuery scripts with the correct versions -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha384-/v8UQ5HNqpZLNr5luvja8XomtOWIlJnDBWpL0o2rn25/Z9v3W4Jp9KG6eF5YK2n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-f4fs5HbOvUSn1LZs1Kb0LTVdQbrXcPqO2/jRUeFWPcZ5tOs7ebDP9w7H9r8SfMrz"
        crossorigin="anonymous"></script>
    <script>
        $(function () {
            $('#navbar-placeholder').load('/Frontend/navbar.html', function () {
                const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
                console.log('Navbar loaded');
                if (loggedInUser) {
                    updateDynamicFeatures(loggedInUser);
                    // Fetch student details from backend
                    $.ajax({
                        url: 'http://127.0.0.1:8000/api/student/info/',
                        type: 'get',
                        headers: {
                            'Authorization': 'Token ' + loggedInUser.token
                        },
                        success: function (response) {
                            // Update HTML elements with student details
                            $('#full_name').text(response.full_name);
                            $('#username').text(response.username);
                            $('#email').text(response.email);
                            $('#photo').attr('src', response.photo);
                            $('#branch').text(response.branch);
                            $('#division').text(response.division);
                            $('#batch').text(response.batch);
                            $('#gender').text(response.gender);
                            $('#phone_number').text(response.phone_number);
                        },
                        error: function (xhr, status, error) {
                            console.log('Error fetching student details');
                        }
                    });
                }
            });
        });

        // Use jQuery or JavaScript to dynamically trigger the modal
        $(document).ready(function () {
            // Example using jQuery
            $('#changePasswordLink').click(function () {
                // Clear previous error messages when opening the modal
                $('#errorMessages').hide().text('');
                $('#changePasswordModal').modal('show');
            });

            // ... (remaining code) ...
        });

        function changePassword() {
            // Retrieve new password details from the form
            var currentPassword = $('#currentPassword').val();
            var newPassword = $('#newPassword').val();
            var confirmNewPassword = $('#confirmNewPassword').val();
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            // AJAX call to the backend API
            $.ajax({
                url: 'http://127.0.0.1:8000/api/accounts/changepassword/',
                type: 'post',
                headers: {
                    'Authorization': 'Token ' + loggedInUser.token
                },
                data: {
                    current_password: currentPassword,
                    new_password: newPassword,
                    confirm_new_password: confirmNewPassword
                },
                success: function (response) {
                    // Password changed successfully
                    console.log(response.detail);
                    alert(response.detail)
                    // You can display a success message or perform any other action
                    $('#changePasswordModal').modal('hide');
                },
                error: function (xhr, status, error) {
                    // Error changing password
                    var errorMessage = JSON.parse(xhr.responseText).detail;
                    console.log(errorMessage);
                    // Display the error message in your modal or any other way you prefer
                    $('#errorMessages').text(errorMessage).show();
                }
            });
        }
    </script>
</body>

</html>