<!-- publish_ride.html -->
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CamBuzz - Vehicle Pooling</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="/Frontend/css/fontawesome.min.css" rel="stylesheet">
    <!-- Popperjs -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha256-BRqBN7dYgABqtY9Hd4ynE+1slnEw+roEPFzQ7TRRfcg=" crossorigin="anonymous"></script>
    <!-- Tempus Dominus JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.9.4/dist/js/tempus-dominus.min.js"
        crossorigin="anonymous"></script>

    <!-- Tempus Dominus Styles -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.9.4/dist/css/tempus-dominus.min.css"
        crossorigin="anonymous">
    <script>
        $(document).ready(function () {
            $('#helmetQuestion').hide();
            $('#vehicleType').change(function () {
                var vehicleType = $(this).val();

                // Use fadeOut to smoothly hide the element
                $('#helmetQuestion').fadeOut('fast', function () {
                    // Set the default value for extra helmet to "No" when the user selects "Car"
                    if (vehicleType === 'Car') {
                        $('#extraHelmet').val('false');
                    }

                    // Use fadeIn to smoothly show the element
                    if (vehicleType === 'Bike') {
                        $('#helmetQuestion').fadeIn('fast');
                    }
                });

                $(".datepicker").each(function () {
                    const picker = new tempusDominus.TempusDominus(this, {
                        format: 'YYYY-MM-DD'
                    });
                });

                $(".timepicker").each(function () {
                    const picker = new tempusDominus.TempusDominus(this, {
                        format: 'HH:mm:ss'
                    });
                });
            });
        });

        function vehicleTypeCheck() {
            var vehicleType = $('#vehicleType').val();
            if (vehicleType == 'Car')
                $('#helmetQuestion').hide();
            else
                $('#helmetQuestion').show();
        }
    </script>
</head>

<body>
    <div id="navbar-placeholder"></div>
    <div class="container-lg" style="text-align: center; margin-top: 50px;">
        <form id="publishRideForm" action="http://127.0.0.1:8000/api/vehiclepooling/publish-ride/" method="post">
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="floatingtext1" placeholder="From Location"
                    name="from_location">
                <label for="floatingtext1">From Location</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="floatingtext2" placeholder="To Location" name="to_location">
                <label for="floatingtext2">To Location</label>
            </div>
            <div class="form-floating mb-3">
                <input type="date" class="form-control datepicker" id="startdate" placeholder="Date / Time"
                    name="start_date"> <label for="startdate">Start Date</label>
            </div>
            <div class="form-floating mb-3">
                <input type="date" class="form-control datepicker" id="enddate" placeholder="Date / Time"
                    name="end_date">
                <label for="enddate">End Date</label>
            </div>
            <div class="form-floating mb-3">
                <input type="time" class="form-control timepicker" id="starttime" placeholder="Date / Time"
                    name="start_time">
                <label for="starttime">Start Time</label>
            </div>
            <div class="form-floating mb-3">
                <input type="time" class="form-control timepicker" id="endtime" placeholder="Date / Time"
                    name="end_time">
                <label for="endtime">End Time</label>
            </div>
            <div class="form-floating mb-3">
                <select class="form-select" id="vehicleType" aria-label="Vehicle Type" onchange="vehicleTypeCheck();"
                    name="vehicle_type">
                    <option selected>Select Vehicle Type</option>
                    <option value="Car">Car</option>
                    <option value="Bike">Bike</option>
                    <option value="Scooty">Scooty</option>
                </select>
                <label for="vehicleType">Vehicle Type</label>
            </div>
            <div class="form-floating mb-3" id="helmetQuestion">
                <select class="form-select" id="extraHelmet" aria-label="Extra Helmet" name="extra_helmet">
                    <!-- <option selected>Select Extra Helmet</option> -->
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                </select>
                <label for="extraHelmet">Do you have an extra helmet?</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="floatingtext5" placeholder="Vehicle Name"
                    name="vehicle_name">
                <label for="floatingtext5">Vehicle Name</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="floatingtext6" placeholder="Vehicle Number"
                    name="vehicle_number">
                <label for="floatingtext6">Vehicle Number</label>
            </div>
            <div class="form-floating mb-3">
                <select class="form-select" id="numberOfSeats" aria-label="Number of Seats" name="seats_available">
                    <option selected>Select Number of Seats</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
                <label for="numberOfSeats">Number of Seats</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="floatingtext7" placeholder="Price" name="price">
                <label for="floatingtext7">Price</label>
            </div>
            <div class="form-floating mb-3">
                <textarea class="form-control" id="floatingtext8" rows="5" name="description"></textarea>
                <label for="floatingtext8">Description</label>
            </div>
            <button type="submit" class="btn btn-primary">Publish</button>
        </form>
        <p>
        <p>
        <p>
        <p></p>
        </p>
        </p>
        </p>
    </div>

    <script>
        $(function () {
            $('#navbar-placeholder').load('/Frontend/navbar.html', function () {
                // Retrieve user information from local storage
                const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));

                if (loggedInUser) {
                    // Call the function to update dynamic features
                    updateDynamicFeatures(loggedInUser);
                }
            });



            // Handle form submission
            $('#publishRideForm').submit(function (event) {

                event.preventDefault();

                // Serialize the form data
                const formData = new FormData(this);
                const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
                console.log(loggedInUser.token);

                // Get the value of extra_helmet from the form data
                let extraHelmetValue = formData.get('extra_helmet');

                // Convert to boolean and set the value back
                formData.set('extra_helmet', extraHelmetValue === 'true' ? true : false);

                // Send a POST request to the backend API with the Authorization header
                $.ajax({
                    type: 'POST',
                    url: 'http://127.0.0.1:8000/api/vehiclepooling/publish-ride/',
                    data: formData,
                    contentType: false, // Ensure proper content type
                    processData: false, // Prevent jQuery from processing data
                    headers: {
                        'Authorization': 'Token ' + loggedInUser.token
                    },
                    success: function (response) {
                        // Handle success response
                        console.log(response);
                        alert("You have published this ride successfully!")
                        window.location.replace('/Frontend/Vehicle Pooling/vehicle_pooling.html')
                    },
                    error: function (xhr, status, error) {
                        // Handle error response
                        const responseJSON = xhr.responseJSON;
                        console.error(responseJSON);

                        // Handle specific error messages
                        if (responseJSON.end_date) {
                            // Display the error for end_date
                            alert(responseJSON.end_date[0]);
                        }

                        if (responseJSON.end_time) {
                            // Display the error for end_time
                            alert(responseJSON.end_time[0]);
                        }

                        if (responseJSON.extra_helmet) {
                            // Display the error for extra_helmet
                            alert(responseJSON.extra_helmet[0]);
                        }
                    }
                });
            });
        });
    </script>
</body>

</html>